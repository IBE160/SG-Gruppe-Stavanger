<?xml version="1.0" encoding="UTF-8"?>
<story-context>
  <metadata>
    <story-id>STORY-2.1</story-id>
    <epic>2 - User Authentication</epic>
    <title>Build Registration Page</title>
    <status>done</status>
  </metadata>

  <requirements>
    <functional-requirement id="FR001">
      User registration with email/password
    </functional-requirement>
    <functional-requirement id="FR016">
      Clear error messages for form validation
    </functional-requirement>
  </requirements>

  <architecture-context>
    <patterns>
      <pattern>React Hook Form for form management</pattern>
      <pattern>Zod for schema validation</pattern>
      <pattern>bcrypt for password hashing</pattern>
      <pattern>Route groups for layout organization</pattern>
    </patterns>

    <file-locations>
      <page>src/app/(unauth)/register/page.tsx</page>
      <api>src/app/api/auth/register/route.ts</api>
    </file-locations>
  </architecture-context>

  <dependencies>
    <package name="react-hook-form" version="^7.0.0" />
    <package name="@hookform/resolvers" version="^3.0.0" />
    <package name="zod" version="^3.22.0" />
    <package name="bcryptjs" version="^2.4.3" />
  </dependencies>

  <validation-schema>
    <![CDATA[
    const registerSchema = z.object({
      name: z.string().min(2, "Name must be at least 2 characters"),
      email: z.string().email("Invalid email address"),
      password: z
        .string()
        .min(8, "Password must be at least 8 characters")
        .regex(/[A-Z]/, "Must contain uppercase")
        .regex(/[a-z]/, "Must contain lowercase")
        .regex(/[0-9]/, "Must contain number"),
      confirmPassword: z.string()
    }).refine(data => data.password === data.confirmPassword, {
      message: "Passwords don't match",
      path: ["confirmPassword"]
    })
    ]]>
  </validation-schema>

  <api-specification>
    <endpoint method="POST" path="/api/auth/register">
      <request>
        <field name="name" type="string" required="true" />
        <field name="email" type="string" required="true" />
        <field name="password" type="string" required="true" />
      </request>
      <responses>
        <response status="201">User created successfully</response>
        <response status="400">Validation error</response>
        <response status="409">Email already exists</response>
        <response status="500">Server error</response>
      </responses>
    </endpoint>
  </api-specification>

  <ui-components>
    <component name="Card" source="shadcn/ui" />
    <component name="Input" source="shadcn/ui" />
    <component name="Button" source="shadcn/ui" />
    <component name="Form" source="shadcn/ui" />
  </ui-components>

  <acceptance-criteria>
    <criterion id="1" status="pass">Page at correct route</criterion>
    <criterion id="2" status="pass">Form validation working</criterion>
    <criterion id="3" status="pass">Password requirements enforced</criterion>
    <criterion id="4" status="pass">Error messages display</criterion>
    <criterion id="5" status="pass">Loading state shown</criterion>
    <criterion id="6" status="pass">Success redirects to login</criterion>
    <criterion id="7" status="pass">Mobile responsive</criterion>
  </acceptance-criteria>

  <code-references>
    <file path="ibe160-app/src/app/(unauth)/register/page.tsx" />
    <file path="ibe160-app/src/app/api/auth/register/route.ts" />
  </code-references>

  <related-stories>
    <story id="STORY-1.4">Auth.js Configuration</story>
    <story id="STORY-2.2">Login Page</story>
  </related-stories>
</story-context>
