<story-context id="{bmad_folder}/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>3</storyId>
    <title>Edit Food Item</title>
    <status>drafted</status>
    <generatedAt>2025-11-29</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/2-3-edit-food-item.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a user</asA>
    <iWant>to edit the details of an existing food item</iWant>
    <soThat>I can correct or update information</soThat>
    <tasks>
      <task id="backend-api" ac="1">
        <description>Backend: API Endpoint</description>
        <subtask>Create a `PUT` or `PATCH` route handler at `app/api/inventory/[id]/route.ts`.</subtask>
        <subtask>Implement logic to update an item in the `inventory` table in the Supabase database.</subtask>
        <subtask>Ensure the endpoint is protected and only the item's owner can perform the update, enforcing RLS policies.</subtask>
        <subtask>Validate incoming data to ensure it matches the expected schema.</subtask>
      </task>
      <task id="frontend-ui" ac="1">
        <description>Frontend: UI Component</description>
        <subtask>Create an "Edit Item" form or modal component.</subtask>
        <subtask>The component should be pre-populated with the existing item's data.</subtask>
        <subtask>On submission, the component should call the client-side update function.</subtask>
      </task>
      <task id="frontend-logic" ac="1">
        <description>Frontend: Client-side Logic</description>
        <subtask>Create a function in `lib/inventoryClient.ts` (or equivalent) to send the `PUT`/`PATCH` request to the API.</subtask>
        <subtask>Integrate this function with the "Edit Item" component.</subtask>
        <subtask>Update the local state of the inventory list to reflect the changes immediately (optimistic update or after API confirmation).</subtask>
      </task>
      <task id="testing" ac="1">
        <description>Testing</description>
        <subtask>Write an API integration test to verify the `PUT /api/inventory/{id}` endpoint works correctly and enforces security.</subtask>
        <subtask>Write a frontend unit test for the "Edit Item" component to ensure it handles user input and submission correctly.</subtask>
        <subtask>Include this flow in an E2E test.</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">
      **Given** I am viewing an item in my inventory, **when** I click to edit the item and update its name, quantity, unit, or expiration date, **then** the changes are saved and reflected in the inventory list.
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <artifact>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>FR2.3 - Edit Food Item</section>
        <snippet>A user can edit the details of an existing food item. Acceptance Criteria: User can update the name, quantity, unit, and expiration date. Changes are reflected in the inventory list immediately.</snippet>
      </artifact>
      <artifact>
        <path>docs/sprint-artifacts/tech-spec-epic-2.md</path>
        <title>Epic Technical Specification: Inventory Management</title>
        <section>PUT /api/inventory/{id}</section>
        <snippet>Update an existing inventory item. Request Body: {"name": "...", "quantity": "...", "unit": "...", "expiration_date": "..."}. Response (200 OK): {"data": {"id": "...", "name": "...", ...}}</snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>API Pattern</section>
        <snippet>RESTful API using Next.js API Routes (Route Handlers). PUT /api/inventory/{id}: Update an existing inventory item.</snippet>
      </artifact>
      <artifact>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Story 2.3: Edit Food Item</section>
        <snippet>As a user, I want to edit the details of an existing food item, so that I can correct or update information. Technical Notes: Use PUT /api/inventory/{id}. Refer to architecture.md and FR2.3 in PRD.md.</snippet>
      </artifact>
      <artifact>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>Modal Patterns</section>
        <snippet>Default modal size is Medium (600px). Can be dismissed with Esc or outside click unless the action is destructive.</snippet>
      </artifact>
    </docs>
    <code>
      <artifact>
        <path>app/api/inventory/[id]/route.ts</path>
        <kind>API Route (to be created)</kind>
        <symbol>PUT</symbol>
        <lines>N/A</lines>
        <reason>Handles the backend logic for updating an inventory item.</reason>
      </artifact>
      <artifact>
        <path>lib/inventoryClient.ts</path>
        <kind>Client-side Logic (to be created)</kind>
        <symbol>updateItem</symbol>
        <lines>N/A</lines>
        <reason>Contains the client-side function to send the PUT request to the API.</reason>
      </artifact>
      <artifact>
        <path>components/specific/EditInventoryItemForm.tsx</path>
        <kind>UI Component (to be created)</kind>
        <symbol>EditInventoryItemForm</symbol>
        <lines>N/A</lines>
        <reason>The form component for editing an item. Should use shadcn/ui components.</reason>
      </artifact>
    </code>
<dependencies>
      <ecosystem name="npm">
        <package>package.json exists, but no dependencies are listed yet.</package>
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>The implementation must follow the RESTful API pattern using Next.js Route Handlers.</constraint>
    <constraint>All data access must go through the defined API layer and respect the Supabase RLS policies.</constraint>
    <constraint>Use `shadcn/ui` components for the form and modal to maintain visual consistency.</constraint>
    <constraint>Use client-side state management (e.g., React Query, SWR, or simple React state) to manage the inventory list and reflect updates.</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>Update Inventory Item</name>
      <kind>REST endpoint</kind>
      <signature>PUT /api/inventory/{id}</signature>
      <path>app/api/inventory/[id]/route.ts</path>
    </interface>
  </interfaces>
  <tests>
    <standards>
      Multi-layered strategy including Unit Tests (`Jest`, `React Testing Library`), Integration Tests (API routes, database interactions), and End-to-End (E2E) Tests (`Playwright`, `Cypress`), focusing on user-centric scenarios.
    </standards>
    <locations>
      <location>tests/</location>
    </locations>
    <ideas>
      <idea ac="1">Write an API integration test to verify the `PUT /api/inventory/{id}` endpoint works correctly and enforces security.</idea>
      <idea ac="1">Write a frontend unit test for the "Edit Item" component to ensure it handles user input and submission correctly.</idea>
      <idea ac="1">Include this flow in an E2E test.</idea>
    </ideas>
  </tests>
</story-context>
